"use strict";(self["webpackChunkcherish"]=self["webpackChunkcherish"]||[]).push([[672],{8672:function(t,e,o){o.r(e),o.d(e,{default:function(){return F}});var a=o(3396),l=o(7139);const n={class:"text-end"},s={class:"table ls"},i=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",null,"名稱"),(0,a._)("th",{width:"200"},"折扣百分比"),(0,a._)("th",{width:"200"},"到期日"),(0,a._)("th",{width:"100"},"是否啟用"),(0,a._)("th",{width:"200"},"編輯")])],-1),d={key:0,class:"text-primary"},p=(0,a._)("i",{class:"bi bi-check2"},null,-1),u=[p],c={key:1,class:"text-muted"},r=(0,a._)("i",{class:"bi bi-x-lg"},null,-1),h=[r],m={class:"btn-group"},b=["onClick"],_=(0,a._)("i",{class:"bi bi-pencil-square"},null,-1),C=["onClick"],f=(0,a._)("i",{class:"bi bi-x-square"},null,-1);function w(t,e,o,p,r,w){const y=(0,a.up)("Loading"),g=(0,a.up)("CouponModal"),M=(0,a.up)("DelModal");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a.Wm)(y,{active:r.isLoading},null,8,["active"]),(0,a._)("div",n,[(0,a._)("button",{type:"button",class:"btn btn-outline-primary",onClick:e[0]||(e[0]=t=>w.openCouponModal(!0))}," 建立優惠券 ")]),(0,a._)("table",s,[i,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.coupons,((e,o)=>((0,a.wg)(),(0,a.iD)("tr",{key:o},[(0,a._)("td",null,(0,l.zw)(e.title),1),(0,a._)("td",null,(0,l.zw)(e.percent)+"%",1),(0,a._)("td",null,(0,l.zw)(t.$filters.date(e.due_date)),1),(0,a._)("td",null,[1===e.is_enabled?((0,a.wg)(),(0,a.iD)("span",d,u)):((0,a.wg)(),(0,a.iD)("span",c,h))]),(0,a._)("td",null,[(0,a._)("div",m,[(0,a._)("button",{type:"button",class:"btn btn-outline-primary btn-sm rounded-0",onClick:t=>w.openCouponModal(!1,e)},[(0,a.Uk)("編輯 "),_],8,b),(0,a._)("button",{type:"button",class:"btn btn-outline-danger btn-sm rounded-0",onClick:t=>w.openDelCouponModal(e)},[(0,a.Uk)("刪除 "),f],8,C)])])])))),128))])]),(0,a.Wm)(g,{coupon:r.tempCoupon,ref:"couponModal",onUpdateCoupon:w.updateCoupon},null,8,["coupon","onUpdateCoupon"]),(0,a.Wm)(M,{item:r.tempCoupon,ref:"delModal",onDelItem:w.delCoupon},null,8,["item","onDelItem"])])}var y=o(9242);const g={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},M={class:"modal-dialog",role:"document"},v={class:"modal-content border-0 ls"},k=(0,a._)("div",{class:"modal-header bg-info text-primary"},[(0,a._)("h5",{class:"modal-title",id:"exampleModalLabel"},"建立優惠券"),(0,a._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),$={class:"modal-body bg-warning text-primary"},x={class:"mb-3"},D={for:"title",class:"form-label w-100"},U={class:"mb-3"},S={for:"coupon_code",class:"form-label w-100"},L={class:"mb-3"},j={for:"due_date",class:"form-label w-100"},V={class:"mb-3"},N={for:"price",class:"form-label w-100"},Z={class:"mb-3"},z={class:"form-check"},I=(0,a._)("p",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),W={class:"modal-footer bg-info"},q=(0,a._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function O(t,e,o,l,n,s){return(0,a.wg)(),(0,a.iD)("div",g,[(0,a._)("div",M,[(0,a._)("div",v,[k,(0,a._)("div",$,[(0,a._)("div",x,[(0,a._)("label",D,[(0,a.Uk)("標題 * "),(0,a.wy)((0,a._)("input",{type:"text",class:"form-control border-bottom border-primary",id:"title","onUpdate:modelValue":e[0]||(e[0]=t=>n.tempCoupon.title=t),placeholder:"請輸入標題"},null,512),[[y.nr,n.tempCoupon.title]])])]),(0,a._)("div",U,[(0,a._)("label",S,[(0,a.Uk)("優惠碼 * "),(0,a.wy)((0,a._)("input",{type:"text",class:"form-control border-bottom border-primary",id:"coupon_code","onUpdate:modelValue":e[1]||(e[1]=t=>n.tempCoupon.code=t),placeholder:"請輸入優惠碼"},null,512),[[y.nr,n.tempCoupon.code]])])]),(0,a._)("div",L,[(0,a._)("label",j,[(0,a.Uk)("到期日 * "),(0,a.wy)((0,a._)("input",{type:"date",class:"form-control border-bottom border-primary",id:"due_date","onUpdate:modelValue":e[2]||(e[2]=t=>n.due_date=t)},null,512),[[y.nr,n.due_date]])])]),(0,a._)("div",V,[(0,a._)("label",N,[(0,a.Uk)("折扣百分比 * "),(0,a.wy)((0,a._)("input",{type:"number",class:"form-control border-bottom border-primary",id:"price","onUpdate:modelValue":e[3]||(e[3]=t=>n.tempCoupon.percent=t),placeholder:"請輸入折扣百分比 %"},null,512),[[y.nr,n.tempCoupon.percent,void 0,{number:!0}]])])]),(0,a._)("div",Z,[(0,a._)("div",z,[(0,a.wy)((0,a._)("input",{class:"form-check-input border border-primary",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[4]||(e[4]=t=>n.tempCoupon.is_enabled=t),id:"is_enabled"},null,512),[[y.e8,n.tempCoupon.is_enabled]]),I])])]),(0,a._)("div",W,[q,(0,a._)("button",{type:"button",class:"btn btn-outline-primary",onClick:e[5]||(e[5]=e=>t.$emit("update-coupon",n.tempCoupon))}," 更新優惠券 ")])])])],512)}var T=o(1339),H={name:"couponModal",props:{coupon:{}},data(){return{tempCoupon:{},due_date:""}},emits:["update-coupon"],watch:{coupon(){this.tempCoupon=this.coupon;const t=new Date(1e3*this.tempCoupon.due_date).toISOString().split("T");[this.due_date]=t},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},mixins:[T.Z]},K=o(89);const P=(0,K.Z)(H,[["render",O]]);var Y=P,A=o(2090),B={components:{CouponModal:Y,DelModal:A.Z},props:{config:Object},data(){return{coupons:{},tempCoupon:{title:"",is_enabled:0,percent:100,code:""},isLoading:!1,isNew:!1}},methods:{openCouponModal(t,e){this.isNew=t,this.isNew?this.tempCoupon={due_date:(new Date).getTime()/1e3}:this.tempCoupon={...e},this.$refs.couponModal.showModal()},openDelCouponModal(t){this.tempCoupon={...t};const e=this.$refs.delModal;e.showModal()},getCoupons(){this.isLoading=!0;const t="https://vue3-course-api.hexschool.io/api/jewelry-api/admin/coupons";this.$http.get(t,this.tempProduct).then((t=>{this.coupons=t.data.coupons,this.isLoading=!1})).catch((t=>{this.$httpMessageState(t,"連線錯誤，請再試一次")}))},updateCoupon(t){if(this.isNew){const e="https://vue3-course-api.hexschool.io/api/jewelry-api/admin/coupon";this.$http.post(e,{data:t}).then((t=>{this.$httpMessageState(t,"更新優惠券"),this.getCoupons(),this.$refs.couponModal.hideModal()})).catch((t=>{this.$httpMessageState(t,"連線錯誤，請再試一次")}))}else{const t=`https://vue3-course-api.hexschool.io/api/jewelry-api/admin/coupon/${this.tempCoupon.id}`;this.$http.put(t,{data:this.tempCoupon}).then((t=>{this.$httpMessageState(t,"更新優惠券"),this.getCoupons(),this.$refs.couponModal.hideModal()})).catch((t=>{this.$httpMessageState(t,"連線錯誤，請再試一次")}))}},delCoupon(){const t=`https://vue3-course-api.hexschool.io/api/jewelry-api/admin/coupon/${this.tempCoupon.id}`;this.isLoading=!0,this.$http.delete(t).then((t=>{this.$httpMessageState(t,"刪除優惠券");const e=this.$refs.delModal;e.hideModal(),this.getCoupons()})).catch((t=>{this.$httpMessageState(t,"連線錯誤，請再試一次")}))}},created(){this.getCoupons()}};const E=(0,K.Z)(B,[["render",w]]);var F=E}}]);
//# sourceMappingURL=672.a7e072e7.js.map